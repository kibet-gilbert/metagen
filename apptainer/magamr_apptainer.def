Bootstrap: docker
From: continuumio/miniconda3

%files
    magamr.yaml

%post
    /opt/conda/bin/conda env create -f magamr.yaml
    NOW=`date`
    meta1version="ApptainerImage.V`date +"%Y.%m.%d"`"
    echo "export NOW=\"${NOW}\"" >> $APPTAINER_ENVIRONMENT
    rm -rf /opt/conda/envs/magamr/opt/krona/taxonomy

%environment
    export PATH=/opt/conda/bin:$PATH
    export PATH=/opt/conda/envs/magamr/bin:$PATH
    export $meta1version

%runscript
    echo "Created on $NOW"
    exec $*

%test
    fastp -v
    fastqc -v
    kraken2 -v
    spades.py -v
    metaspades.py -v
    CAT -v
    kma -v
    prodigal -v
    bowtie2 --version
    bedtools --version
    samtools
    bamtools
    bwa
    run_MaxBin.pl -h
    ktUpdateTaxonomy.sh -h
    metabat2 -h
    #MaxBin

%labels
    Author: kibet-gilbert
    Version: $meta1version

%help
    Singularity container for viral shotgun metagenomics - MAGviral
    Apps available:
    fastp		Trim and removes adapters from fastq files
    fastqc		QCs the fastq files and outputs a html file
    bowtie2		Align reads to reference
    samtools		works on fastq/fasta/bam/sam... index/view/filter...
    bamtools		samtools companion
    bwa			Align reads to reference
    kma			Align reads to reference
    prodigal		protein prediction analysis
    bedtools		genome arithmetics* fasta/fastq/bam: conversion/vis/stats
    kraken2		Performs taxonomic classification of reads and contigs
    ktUpdateTaxonomy.sh	Inbuilt krona tools app to build/update a krona database from NCBI taxonomy/taxdump.tar.gz
    ktImportTaxonomy	Inbuilt krona tools app to import and create an interative pie-chart visual of taxonomic abundancies
    spades.py		Assembly of the genomes
    metaspades.py	Assembly pf metagenomes (Same as: spades.py --meta)
    MaxBin		MaxBin tool to perform binning of contigs/reads
    metabat2		Bins contigs (Alternative to run_MaxBin.pl)
    #checkm2		Predict the completeness and contamination of genome bins
    #DAS_Tool		Refines Bins: integrates results from multiple binning algorithms to an optimized, non-redundant set of bins from a single assembly
    CAT			Contig Annotation Tool (CAT) - taxonomic classification (long DNA sequences, MAGs / bins) of known and highly unknown microorganisms
    blast*		NCBI BLAST 2.16.0+ toolkit: blast2sam.pl|blastdb_convert|blastn|blastx|blastdb_aliastool|blastdbcp|blastn_vdb|blastdbcheck|blastdb_path|blastp|blastdbcmd|blast_formatter|blast_report|esearch|efetch|elink|epost|xtract

