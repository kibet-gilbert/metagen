params {
    outdir = './results'
    publish_dir_mode = 'copy'

    // Database parameters
    ccmetagen_db    = null
    db_action       = null
}

profiles {
  conda {
    conda.enabled = true
    process.executor = 'local'
    process.container = false
  }

  mamba {
    conda.enabled = true
    conda.autoActivate = false
    conda.useMamba = true
    process.executor = 'local'
    process.container = false
  }

  docker {
    process.container = true
    containerEngine = 'docker'
    process.executor = 'local'
  }

  singularity {
    process.container = true
    containerEngine = 'singularity'
    process.executor = 'local'
  }

  apptainer {
    process.container = true
    containerEngine = 'apptainer'
    process.executor = 'local'
  }
}

docker.enabled = false
singularity.enabled = false
apptainer.enabled = true

process {

    // Global defaults
    cpus   = 2
    memory = '4 GB'
    errorStrategy = 'retry'
    maxRetries = 2

    // -----------------------------------------------------
    // FASTP MODULE
    // -----------------------------------------------------

    withName: FASTP {
        cpus   = 4
        memory = '300 GB'
        // container = 'quay.io/biocontainers/fastp:0.23.4--h5f740d0_0'
        container = '/home/gkibet/bioinformatics/github/apptainer/fastp/fastp_apptainer.sif'
        errorStrategy = 'retry'
        maxRetries = 2
        publishDir = [
            path: "${params.outdir}/fastp",
            mode: params.publish_dir_mode
        ]
    }

    // -----------------------------------------------------
    // CCMetagen DB MODULE
    // -----------------------------------------------------
    withName: CCMETAGEN_DB {
        cpus = 8
        memory = '300 GB'
        // container = 'docker.io/genomicepidemiology/kma:latest'
        container = '/home/gkibet/bioinformatics/github/apptainer/ccmetagen/ccmetagen_apptainer.sif'
        errorStrategy = 'retry'
        maxRetries = 2
        publishDir = [
            path: "${params.outdir}/ccmetagen_db",
            mode: params.publish_dir_mode
        ]
    }

    // -----------------------------------------------------
    // KMA MODULE
    // -----------------------------------------------------
    withName: KMA {
        cpus = 8
        memory = '300 GB'
        // container = 'docker.io/genomicepidemiology/kma:latest'
        container = '/home/gkibet/bioinformatics/github/apptainer/ccmetagen/ccmetagen_apptainer.sif'
        errorStrategy = 'retry'
        maxRetries = 2
        publishDir = [
            path: "${params.outdir}/kma",
            mode: params.publish_dir_mode
        ]
    }

    // -----------------------------------------------------
    // CCMetagen MODULE
    // -----------------------------------------------------
    withName: CCMETAGEN {
        cpus = 4
        memory = '300 GB'
        // container = 'quay.io/biocontainers/ccmetagen:1.3--py39_0'
        container = '/home/gkibet/bioinformatics/github/apptainer/ccmetagen/ccmetagen_apptainer.sif'
        errorStrategy = 'retry'
        maxRetries = 2
        publishDir = [
            path: "${params.outdir}/ccmetagen",
            mode: params.publish_dir_mode
        ]
    }
}

